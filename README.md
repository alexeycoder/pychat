# Чат на TCP-сокетах

## Примечания:

* Запуск сервера: __`python3 server.py`__
* Запуск клиентского приложения: __`python3 main.py`__
* Для работы требуется python версии не ниже 3.9 ввиду использования
составных type hints.
* Для работы клиентского приложения требуется установленный модуль _tkinter_ для интерпретатора (`sudo apt-get install python3-tk` в debian или `sudo pacman -S tk` в arch)

## Структура:

* Модуль общих для сервера и клиента констант и функций:
	* common.py
* Приложение сервера:
	* server.py
* Приложение клиента:
	* main.py &mdash; точка запуска
	* client.py &mdash; модуль для обслуживания клиентского сетевого соединения
	* chat_window.py &mdash; оконный интерфейс для клиента
 	* controller.py &mdash; модуль, связующий GUI и жизненный цикл сетевого соединения

Сервер однопоточный, конкурентность достигается до счёт подхода с использованием сопрограмм (модуль _asyncio_).

Клиентское приложение двухпоточное: основной поток обслуживает жизненный цикл оконного интерфейса, дополнительный поток обслуживает жизненный цикл сетевого соединения в аналогичном серверу ключе (неблокирующие вызовы сопрограмм в одном потоке).

Для осуществления передачи сообщений участников чата, поверх TCP-протокола реализован следующий протокол уровня приложения:
Сообщения приложения-клиента и сервера предваряются префиксом с длиной payload'a в байтах, кодированной ascii символами цифр и последующим символом-разделителем (двоеточие).
Payload'ом являются закодированные в текстовый формат JSON сообщения, содержащие помимо непосредственно текста сообщения, ещё имя отправителя и тип сообщения ('hello' &mdash; во время которого участник сообщает серверу своё имя, 'text' &mdash; простое сообщение в чат от участника, 'message' &mdash; сообщение, с указанием имени источника, пересылаемое от сервера к участнику чата).

## Примеры работы:

![example_username](https://github.com/alexeycoder/pychat/assets/109767480/18ef98c4-ef9f-4732-8e3b-a2eb087df908)

![example_server](https://github.com/alexeycoder/pychat/assets/109767480/5659afcc-2464-44bb-b8a7-5e920737f177)

![example_chating](https://github.com/alexeycoder/pychat/assets/109767480/191efbdb-4e86-439d-8e37-3060fc11e25b)

![example_no_connection](https://github.com/alexeycoder/pychat/assets/109767480/2d3b0f83-8ab7-43b6-bd87-976ceca2efd6)

*Прослушивающий сокет:*

![screen_server_socket](https://github.com/alexeycoder/pychat/assets/109767480/29288c25-ab2d-450c-87bf-16a32a9ace05)

*Вариант сшитой перехваченной TCP-сессии:*

![screen_chating_via_wireshark](https://github.com/alexeycoder/pychat/assets/109767480/316c1575-2155-4f5f-9f19-f95875d1fd12)
